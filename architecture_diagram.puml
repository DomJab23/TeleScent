@startuml TeleScent Architecture
!define RECTANGLE class
!theme cyborg
skinparam backgroundColor #1E1E1E
skinparam defaultTextAlignment center
skinparam componentStyle rectangle

title <color:#FFFFFF>TeleScent - Full System Architecture</color>

' Define dark theme color scheme
skinparam component {
    BackgroundColor<<frontend>> #1E3A5F
    BorderColor<<frontend>> #64B5F6
    FontColor<<frontend>> #FFFFFF
    BackgroundColor<<backend>> #4A3200
    BorderColor<<backend>> #FFB74D
    FontColor<<backend>> #FFFFFF
    BackgroundColor<<ml>> #1B5E20
    BorderColor<<ml>> #81C784
    FontColor<<ml>> #FFFFFF
    BackgroundColor<<data>> #4A148C
    BorderColor<<data>> #BA68C8
    FontColor<<data>> #FFFFFF
    BackgroundColor<<external>> #B71C1C
    BorderColor<<external>> #EF5350
    FontColor<<external>> #FFFFFF
}

skinparam actor {
    BackgroundColor #424242
    BorderColor #FFFFFF
    FontColor #FFFFFF
}

skinparam note {
    BackgroundColor #2C2C2C
    BorderColor #757575
    FontColor #FFFFFF
}

skinparam arrow {
    Color #9E9E9E
    FontColor #FFFFFF
}

skinparam package {
    BackgroundColor #252525
    BorderColor #616161
    FontColor #FFFFFF
}

skinparam database {
    BackgroundColor #4A148C
    BorderColor #BA68C8
    FontColor #FFFFFF
}

skinparam storage {
    BackgroundColor #4A148C
    BorderColor #BA68C8
    FontColor #FFFFFF
}

' User/Client Layer
actor User as user

' Frontend Layer
package "Frontend Layer" {
    component "React App\n(Port 3000)" as react <<frontend>> {
        [Dashboard]
        [ML Console]
        [Sensor Data View]
        [Login/Register]
    }
}

' Backend Layer
package "Backend Layer" {
    component "Express.js API\n(Port 5001)" as backend <<backend>> {
        [Auth Routes]
        [Sensor Data Routes]
        [Predictions Routes]
        [Stats Routes]
        [JWT Middleware]
    }
}

' ML Service Layer
package "ML Service Layer" {
    component "Python ML Service" as ml <<ml>> {
        [Model Inference\n(serve.py)]
        [Data Collection]
        [Model Training]
    }
    
    component "Trained Models" as models <<ml>> {
        [6-Sensor Pipeline]
        [2-Sensor Simple Model]
        [Label Encoder]
    }
}

' Data Layer
package "Data Layer" {
    database "SQLite Database" as db <<data>> {
        [Users Table]
        [Sensor Data Table]
        [Predictions Table]
    }
    
    storage "CSV Export" as csv <<data>> {
        [sensor_data.csv]
        [Training Datasets]
    }
}

' External Services
package "External Services" {
    component "IoT Sensors\n(ESP32/Arduino)" as sensors <<external>>
    component "Ngrok Tunnel\n(Port 4040)" as ngrok <<external>>
}

' User interactions
user --> react : "Web Browser"

' Frontend to Backend
react --> backend : "REST API\n(HTTP/HTTPS)"
react <-- backend : "JSON Response"

' Backend to ML Service
backend --> ml : "Subprocess Call\n(Python)"
ml --> backend : "JSON Prediction"

' ML to Models
ml --> models : "Load Models\n(joblib)"

' Backend to Data
backend --> db : "CRUD Operations\n(Sequelize ORM)"
backend --> csv : "Export Data"

' ML Training Flow
csv --> ml : "Training Data"

' External Services
sensors --> backend : "POST /api/sensor-data\n(Real-time data)"
ngrok --> backend : "Proxy Tunnel\n(Public Access)"

' Data flow for predictions
backend --> db : "Store Raw\nSensor Data"
backend --> ml : "Request\nPrediction"
ml --> backend : "Return Scent\nClassification"
backend --> db : "Store\nPrediction Result"

' Notes
note right of sensors
  - Multi-sensor array
  - VOC, NOx, NO2, Ethanol
  - Temperature, Humidity
  - Real-time streaming
end note

note right of ml
  - scikit-learn models
  - 6-sensor full pipeline
  - 2-sensor simple model
  - Real-time inference
end note

note bottom of db
  - User authentication
  - Sensor readings history
  - Prediction analytics
  - Training data storage
end note

note left of ngrok
  - Public URL exposure
  - Webhook support
  - Remote IoT access
end note

@enduml
