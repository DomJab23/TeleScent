
@startuml TeleScent State Diagram

skinparam backgroundColor #FFFFFF
skinparam defaultFontSize 10

title TeleScent - State Diagrams

state "eNose Device" as enose {
  [*] --> PowerOff
  PowerOff --> Preheating : Power On
  Preheating --> Ready : 30 min
  Ready --> Collecting : Start
  Collecting --> Transmitting : Done
  Transmitting --> Ready : Success
  Transmitting --> Error : GSM Fail
  Error --> Ready : Retry
}

state "Backend Processing" as backend {
  [*] --> Idle
  Idle --> Receiving : POST
  Receiving --> Validating
  Validating --> Storing : Valid
  Validating --> Idle : Invalid
  Storing --> Broadcasting : SSE
  Broadcasting --> Checking
  Checking --> ForcingNoScent : Drop >= 4
  Checking --> RunningML : Normal
  ForcingNoScent --> Storing
  RunningML --> WaitingML
  WaitingML --> ApplyingLogic
  ApplyingLogic --> StoringPred
  StoringPred --> Idle : 200 OK
}

state "Prediction Lifecycle" as prediction {
  [*] --> NoScent
  NoScent --> Detecting : VOC/NO2 Rise
  Detecting --> Counting : Predicted
  Counting --> Counting : Same (count++)
  Counting --> Detecting : Different
  Counting --> Confirmed : Count = 3
  Confirmed --> Emitting : Control Gen
  Emitting --> ForcedOff : Count >= 3
  ForcedOff --> NoScent
  Detecting --> NoScent : Drop >= 4
}

state "Emitter Device" as emitter {
  [*] --> Standby
  Standby --> Polling : Timer
  Polling --> Receiving : GET
  Receiving --> SettingPWM : Valid
  SettingPWM --> Emitting : PWM Set
  Emitting --> Standby : Done
}

enose --> backend : Transmitting\nvia GSM
backend --> prediction : RunningML\ntriggers
prediction --> emitter : Emitting\npolled by
emitter --> backend : Polling\nGET request

@enduml
